<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.renren.modules.sys.dao.StuDao">
    <insert id="addStu" useGeneratedKeys="true" keyProperty="stuId">
        insert into tb_stu(stu_name,
                           open_id,
                           mobile,
                           gender,
                           address,
                           age,
                           parent)
        values (#{stuName},
                #{openId},
                #{mobile},
                #{gender},
                #{address},
                #{age},
                #{parent})
    </insert>

    <select id="selectAllStu" resultType="io.renren.modules.sys.vo.StuVO">
        SELECT a.stu_id,
               a.stu_name,
               a.gender,
               a.age,
               a.parent,
               a.mobile,
               b.sub_name,
               b.sub_total,
               b.sub_use,
               b.sub_surplus,
               a.create_time,
               a.update_time
        from tb_stu a
                 inner JOIN tb_subject b
                            on a.stu_id = b.stu_id
        <where>
            <if test="stuName != null and stuName != ''">
                a.stu_name like '%${stuName}%'
            </if>
            <if test="subName != null and subName != ''">
                b.sub_name like '%${subName}%'
            </if>
        </where>
    </select>

<!--通过用户的ID查询用户的openid用于发送消息-->
    <select id="selectAllStuOPenId" resultType="io.renren.modules.sys.vo.StuOpenidVO">
        select stu_id, open_id from tb_stu
    </select>

    <!--通过学生的id查询学生的详情-->
    <select id="selectStuInfo" resultType="io.renren.modules.sys.vo.StuVO">
        SELECT a.stu_id,
                a.stu_name,
                a.gender,
                a.age,
                a.address,
                a.parent,
                a.mobile,
                b.sub_name,
                b.sub_total,
                b.sub_use,
                b.cost,
                b.sub_surplus,
                a.create_time,
                a.update_time
        from tb_stu a
            inner JOIN tb_subject b
            on a.stu_id = b.stu_id
        where a.stu_id = #{stuId}
    </select>

    <!--学生姓名的重复性判断-->
    <select id="findStuByName" parameterType="string" resultType="integer">
        select count(1) from tb_stu where stu_name = #{stuName}
    </select>
</mapper>